# AWS 遠端主機部署紀錄

### 前情提要
進度落後的我終於來到部署體驗週了！看之前同學的進度報告，大家幾乎都是看以前學長姐的筆記成功部署的，但課程也進行一段時間了，蠻想知道自己現在看文件的能力如何，所以一開始打算先自己嘗試。

我之前的工作是翻譯 Google 文件，所以現在看到他們的文件就蠻想吐的，因此這次就選擇用 AWS 的服務。另外也是因為覺得越多人使用的東西資源越多，現在還這麼菜最好不要自討苦吃選教學文比較少的服務，先成功部署後想嘗試別的應該也會比較容易。

### 購買/連線到主機
決定要買哪一家的主機之後就是看文件，AWS 提供的服務多到我眼花，先研究了一陣子才知道我要找的是 EC2，接下來靠著 EC2 的文件成功 launch 了一台 ubuntu 主機，並用 SSH 從本地連線到遠端主機。成功連進主機的那一刻真的很感動，但是，接下來我就完全沒有頭緒了。所以我結束了自己研究部署的小冒險，乖乖點開學長姐的筆記繼續部署。

### LAMP + MySQL 設定
這部分幾乎都是參考筆記做完的，不過因為 MySQL 那邊的設定有點複雜，所以中間還是有碰到一些問題卡關。第一次卡關是因為我想做一些筆記沒寫到的事情，所以我沒有裝 phpmyadmin，而是另外找了一個管理工具 adminer 來裝，但是裝完發現我不知道怎麼登入，可能有哪裡的設定調錯了，結果最後弄到連不上主機。現在回頭看覺得應該是 mysql 密碼沒有設定好，但因為當時參考太多份筆記，又記不清楚自己到底做了哪些操作，所以最後放棄 debug，直接再開一台新主機從頭來過，並且一步一步按照筆記操作，這次才成功部署。

### 上傳檔案
我是到 github 開一個新的 repo，再 clone 到遠端主機上。做到這覺得部署同時也是在複習第一週，我原本連怎麼 clone 都快忘記了😂

### 買網域 + 綁定網址
這部分應該是大家覺得最簡單的一趴，但我卡到爆？
要綁定網址，只要調整 A 紀錄就好，但我第一次設定完卻沒有成功，點進去網址只看到 gandi 那張停車場照片，上面寫著 This domain name has been registered。來來回回試了很多次都還是不行，最後猜可能是綁定需要時間，所以就放著到晚上，再點開網址就成功了。

不對，我並沒有成功。因為我後來還設定了 www 的 CNAME 和轉址，設定 CNAME 是想把網址列輸入 www.mtr05-jackie.tw 的使用者導到 mtr05-jackie.tw，設定轉址是想把瀏覽首頁的人導到我放檔案的資料夾。這兩項設定弄完就又壞了，但因為設定生效都需要時間，所以我根本不知道錯誤出在哪。

後來我發現區域檔紀錄都可以設定 TTL，我把 TTL 時間改成最短的 300 秒，讓我做的變更可以快點生效，然後再把轉址設定刪掉後就成功了。我也發現我其實不需要設定轉址，只要修改 Apache 預設目錄就好了。
```
sudo vim etc/apache2/sites-enabled/000-default.conf
```
可以用這個指令打開 000-default.conf 檔案，然後把 DocumentRoot 改成我想要的檔案路徑。

### 後記：SSH 連線與 ufw 防火牆問題
先說，我整個部署過程總共跑了四次，第一次部署完後遇到 ssh 連線問題，但因為根本不知道自己打了什麼指令，最後放棄 debug 直接開一台新的主機。第二次遇到網域綁定問題，又死馬當活馬醫開了第三台主機 (結果後來發現只是設定還沒生效)。第三次我又遇到 ssh 連線問題，不過這次是在設定完防火牆和資料庫密碼後出事，所以比較能夠鎖定出錯的範圍。但這次遇到問題時，心態有點沒調整好，只覺得心很累，所以，我又開了第四台主機。

第四次主機部署到一半，我才突然驚覺自己沒有在 mattermost 上找過答案，搞不好其他同學也遇到一樣的問題，結果一查，果然直接找到答案！問題出在我沒有先設定好 ufw 就直接啟用防火牆，所以把自己檔在牆外了。後來我找到一篇蠻不錯的[文章](https://noob.tw/ufw/)，照著設定允許電腦 IP 連到所有遠端主機的 port，然後再下 `sudo ufw enable` 指令，終於完成整個部署流程。

### 心得
* CLI + Linux 學好功力應該會大增
* 越多人用的工具越容易找到教學
* 發生錯誤應該即時記錄方便後續 debug

從 command line 和 Git 開始學起，到後面一步步寫出前後端程式，再把它架到自己的網站上，走完整個過程蠻感動的。結束部署後再開始學現代前後端開發，走到這一週終於領悟課綱為什麼這樣安排了。這次遇到 ssh 連線問題，雖然最後有順利解決，但還是有點自責，明明知道自己進度落後，遇到問題怎麼不先找找看前人留下來的答案。另外也自責自己沒有提問，我不是一個很擅長提問的人，如果我不在這個計畫裡練習，之後正式工作應該會更痛苦。
總之很開心完成部署，也期許自己可以更懂得怎麼提問和解決問題。
